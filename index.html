<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://pyscript.net/latest/pyscript.css" />
    <script defer src="https://pyscript.net/latest/pyscript.js"></script>
    <title>Document</title>
</head>
<body>

    <py-script>
        import re
        
        def decryptRailFence(cipher, key):
            rail = [['\n' for i in range(len(cipher))]
                    for j in range(key)]

            dir_down = None
            row, col = 0, 0

            for i in range(len(cipher)):
                if row == 0:
                    dir_down = True
                if row == key - 1:
                    dir_down = False

                # place the marker
                rail[row][col] = '*'
                col += 1
                if dir_down:
                    row += 1
                else:
                    row -= 1
            index = 0
            for i in range(key):
                for j in range(len(cipher)):
                    if ((rail[i][j] == '*') and
                            (index < len(cipher))):
                        rail[i][j] = cipher[index]
                        index += 1
            result = []
            row, col = 0, 0
            for i in range(len(cipher)):
                if row == 0:
                    dir_down = True
                if row == key - 1:
                    dir_down = False

                # place the marker
                if (rail[row][col] != '*'):
                    result.append(rail[row][col])
                    col += 1
                if dir_down:
                    row += 1
                else:
                    row -= 1
            return ("".join(result))

        def a2i(ch):
            ch = ch.upper()
            arr = {'A': 0, 'B': 1, 'C': 2, 'D': 3, 'E': 4, 'F': 5, 'G': 6, 'H': 7, 'I': 8, 'J': 9, 'K': 10,
                    'L': 11, 'M': 12, 'N': 13, 'O': 14, 'P': 15, 'Q': 16, 'R': 17, 'S': 18, 'T': 19, 'U': 20,
                    'V': 21, 'W': 22, 'X': 23, 'Y': 24, 'Z': 25}
            return arr[ch]

        def i2a(i):
            i = i % 26
            arr = (
                'A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P', 'Q', 'R', 'S', 'T', 'U', 'V',
                'W', 'X', 'Y', 'Z')
            return arr[i]

        def remove_punctuation(text, filter='[^A-Z]'):
            return re.sub(filter, '', text.upper())


        def decryptVigenere(cipher, key):
            string = remove_punctuation(cipher)
            ret = ''
            for (i, c) in enumerate(string):
                i = i % len(key)
                ret += i2a(a2i(c) - a2i(key[i]))
            return ret


        glossaries = open('glossaries.txt', 'r').read().split("\n")
        words = open('keywords.txt', 'r').read().split("\n")
        rf_key_length = 8
        results = []

        print('Rail-Fence + Vigenere Cipher | Brute-Force Decryption by Damian')
        ciphertext = input('Input Ciphertext: ')

        for rf_key in range(2, rf_key_length + 1):
            rf_ciphertext = decryptRailFence(ciphertext, rf_key)
            if "  " not in rf_ciphertext:
                for v_key in glossaries:
                    v_ciphertext = decryptVigenere(rf_ciphertext, v_key)
                    score = 0
                    for word in words:
                        score += v_ciphertext.count(word.upper())
                    results.append([score, rf_key, v_key, v_ciphertext])

        print('\n-- Top 3 Results --')
        for result in sorted(results, reverse=True)[:3]:
            print(f'Score = {result[0]} | Rail-Fence Key = {result[1]} | Vigenere Key = {result[2]} | Plain Text = {result[3]}')

        dummy = input("\nPress any key to exit.")

    </py-script>|
</body>
</html>